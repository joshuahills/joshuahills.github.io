---
import BaseLayout from '../layouts/BaseLayout.astro';
import SkillsSection from '../components/SkillsSection.astro';
import ExperienceSection from '../components/ExperienceSection.astro';
import SocialLinks from '../components/SocialLinks.astro';

const exp = new Date().getFullYear() - new Date(2021, 8).getFullYear();

const commitHash = import.meta.env.PUBLIC_COMMIT_HASH || 'dev';
const fullCommitHash = import.meta.env.PUBLIC_FULL_COMMIT_HASH || commitHash;
---

<BaseLayout title="Josh Hills - Software Engineer">
  <div class="max-w-screen-xl mx-auto px-8">
    <!-- Hero Section -->
    <section class="min-h-screen flex flex-col justify-center relative py-16 md:py-32">
      
      <h1 class="font-sans font-black uppercase tracking-tighter leading-[0.85] mb-8 text-[clamp(4rem,12vw,8rem)] relative z-10" aria-label="Josh Hills">
        <span class="block text-outline absolute top-1 left-1 opacity-30 select-none pointer-events-none" aria-hidden="true">Josh</span>
        <span class="block text-transparent bg-clip-text bg-gradient-to-r from-white to-white/50 relative z-10">Josh</span>
        <span class="block text-outline absolute top-[0.85em] left-1 opacity-30 select-none pointer-events-none" aria-hidden="true">Hills</span>
        <span class="block text-transparent bg-clip-text bg-gradient-to-r from-custom-primary to-custom-secondary relative z-10 glitch" data-text="Hills">Hills</span>
      </h1>
      
      <p class="mb-16 font-mono text-[clamp(1rem,2vw,1.25rem)] text-custom-muted leading-none flex items-center gap-4">
        <span class="w-12 h-[1px] bg-custom-secondary"></span>
        Software Engineer
        <span class="text-custom-accent">//</span>
        East Mids, UK
      </p>

      <div class="glass-panel p-8 md:p-10 mb-12 rounded-2xl border border-white/5 hover:border-custom-primary/30 transition-all duration-500 group relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-custom-primary/5 to-custom-secondary/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
        <p class="text-lg md:text-xl leading-relaxed mb-6 text-custom-text font-light relative z-10">
          Hey there! I'm Josh, a software engineer with <span class="text-custom-primary font-bold text-glow">{exp} years</span> of professional experience crafting scalable applications
          and solving complex technical challenges. I specialise in <span class="text-custom-secondary font-medium">.NET</span>, <span class="text-custom-secondary font-medium">TypeScript</span>, and <span class="text-custom-secondary font-medium">distributed systems</span>.
        </p>
        <p class="text-custom-muted font-light relative z-10">
          When I'm not wrestling with microservices or optimizing database queries, you might find me experimenting with
          real-time video processing or walking in muddy English fields.
        </p>
      </div>

      <SocialLinks />

      <!-- Scroll Indicator -->
      <a href="#skills" id="scroll-indicator" class="scroll-indicator absolute bottom-8 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 text-custom-accent hover:text-custom-primary transition-all duration-500 group cursor-pointer">
        <span class="scroll-text"/>
        <div class="relative w-6 h-10 border-2 border-current rounded-full p-1">
          <div class="w-1.5 h-1.5 bg-current rounded-full mx-auto"></div>
        </div>
        <svg class="w-4 h-4 animate-bounce scroll-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"/>
        </svg>
      </a>
    </section>

    <script>
      // Smooth scroll for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const href = anchor.getAttribute('href');

          if (!href) return;

          if (href === '#top') {
            window.scrollTo({
              top: 0,
              behavior: 'smooth'
            });
          } else {
            const target = document.querySelector(href);
            if (target) {
              target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
            }
          }
        });
      });

      // Flip scroll indicator based on scroll position
      const scrollIndicator = document.getElementById('scroll-indicator');
      const scrollText = scrollIndicator?.querySelector('.scroll-text') as HTMLElement | null;

      window.addEventListener('scroll', () => {
        if (!scrollIndicator || !scrollText) return;

        const scrolled = window.scrollY > window.innerHeight * 0.5;

        if (scrolled) {
          scrollIndicator.style.transform = 'translateX(-50%) rotate(180deg)';
          scrollIndicator.setAttribute('href', '#top');
        } else {
          scrollIndicator.style.transform = 'translateX(-50%) rotate(0deg)';
          scrollIndicator.setAttribute('href', '#skills');
        }
      });
    </script>

    <!-- Skills Section -->
    <SkillsSection />

    <!-- Experience Section -->
    <ExperienceSection />

    <!-- Footer -->
    <footer class="relative py-12 text-custom-muted border-t-2 mt-16" style="border-color: var(--color-surface);">
      <div class="text-center">
        <p>Â© {new Date().getFullYear()} Josh Hills.</p>
        <p class="mt-2 text-sm">
          Built with Astro.
        </p>
      </div>
      <div class="absolute bottom-4 left-4 text-xs font-mono opacity-50 hover:opacity-100 transition-opacity">
        <a
          href={`https://github.com/joshuahills/joshuahills.github.io/commit/${fullCommitHash}`}
          target="_blank"
          rel="noopener noreferrer"
          class="text-custom-muted hover:text-custom-accent transition-colors"
        >
          {commitHash}
        </a>
      </div>
    </footer>
  </div>
</BaseLayout>
